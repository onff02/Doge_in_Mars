// Prisma Schema for Doge City in Mars
// í™”ì„± ê°ˆë„ë‹ˆê¹Œ - ë°ì´í„° ê¸°ë°˜ í•­ë¡œ ìµœì í™” ê²Œì„

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ìœ ì € ì •ë³´
model User {
  id          Int             @id @default(autoincrement())
  email       String          @unique
  password    String
  nickname    String
  introViewed Boolean         @default(false)
  sessions    FlightSession[]
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  @@map("users")
}

// ë¡œì¼“ ìŠ¤í™ (PER, PBR, ROE ë§¤í•‘)
model Rocket {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  description String?  // ë¡œì¼“ ì„¤ëª…
  imageUrl    String?  // ë¡œì¼“ ì´ë¯¸ì§€ URL
  category    String   // Growth, Blue-Chip, Dividend
  boost       Float    // PER ë§¤í•‘: ê°€ì† í­ë°œë ¥
  fuelEco     Float    // ROE ë§¤í•‘: ì—°ë¹„ íš¨ìœ¨
  armor       Float    // PBR ë§¤í•‘: ì„ ì²´ ë‚´êµ¬ë„
  events      GameEvent[]
  sessions    FlightSession[]

  @@map("rockets")
}

// ë°˜ì „ ê²°ê³¼ ìœ í˜• Enum
enum TwistType {
  NONE           // ë°˜ì „ ì—†ìŒ
  POSITIVE       // ê¸ì •ì  ë°˜ì „ (ì•…ì¬â†’í˜¸ì¬)
  NEGATIVE       // ë¶€ì •ì  ë°˜ì „ (í˜¸ì¬â†’ì•…ì¬)
}

// Global ì´ë²¤íŠ¸ ìœ í˜• Enum
enum GlobalEventType {
  BEAR_TRAP      // í•˜ë½ì¥ í•¨ì • (Armor ë†’ìœ¼ë©´ ë°˜ë“±)
  BULL_RUN       // ìƒìŠ¹ì¥ (Boost ë¹„ë¡€ ê°€ì†)
  BUBBLE_BURST   // ë²„ë¸” ë¶•ê´´ (Boost ë†’ìœ¼ë©´ í˜ë„í‹°)
  NEUTRAL        // ì¤‘ë¦½
}

model GameEvent {
  id             Int      @id @default(autoincrement())
  round          Int
  isGlobal       Boolean  @default(true)
  targetRocketId Int?     // Specific ì´ë²¤íŠ¸ì¼ ê²½ìš° í•´ë‹¹ ë¡œì¼“ ID
  rocket         Rocket?  @relation(fields: [targetRocketId], references: [id])
  
  // ì •ë³´ ì‹œìŠ¤í…œ 3ì¢… ì„¸íŠ¸
  newsTitle      String   // ì‹¬ìš°ì£¼ ì„¼ì„œ (ë‰´ìŠ¤ ì œëª©)
  newsDetail     String   // AI ë„¤ë¹„ê²Œì´í„° (ë¶„ì„ ë©˜íŠ¸)
  newsLog        String   // í•­í•´ ê¸°ë¡ (ê³¼ê±° ë°ì´í„°)
  
  thrustMod      Float    // ê¸°ë³¸ ì¶”ë ¥ ë°°ìœ¨ (1.5, 0.7 ë“±)
  isTwist        Boolean  @default(false) // ë°˜ì „ ì—¬ë¶€
  twistType      TwistType @default(NONE) // ë°˜ì „ ìœ í˜• (Pos/Neg)
  globalType     GlobalEventType? // Global ì´ë²¤íŠ¸ ìœ í˜• (Bear Trap, Bull Run ë“±)
  
  // ìŠ¤íƒ¯ ì—°ë™ í•„ë“œ
  affectedStat   String?  // ì˜í–¥ë°›ëŠ” ìŠ¤íƒ¯ (boost, armor, fuelEco)
  statMultiplier Float?   // ìŠ¤íƒ¯ ë°°ìœ¨ (ìŠ¤íƒ¯ ê°’ì— ê³±í•´ì§€ëŠ” ê³„ìˆ˜)

  @@map("game_events")
}

// ë¼ìš´ë“œ ì§„í–‰ ë‹¨ê³„ Enum
enum RoundPhase {
  NEWS              // ë‰´ìŠ¤ ê³µê°œ ë‹¨ê³„ (ê°€ì§œ ì •ë³´)
  PLAYING           // í”Œë ˆì´ ë‹¨ê³„ (ìœ ì € ì…ë ¥)
  RESULT            // ê²°ê³¼ ê³µê°œ ë‹¨ê³„ (ë°˜ì „ ê³µê°œ)
}

// ì„¸ì…˜ ìƒíƒœ Enum
enum SessionStatus {
  IN_PROGRESS
  COMPLETED
  FAILED
}

// íˆ¬ì ì„±í–¥ Enum
enum InvestingStyle {
  AGGRESSIVE_GROWTH     // ê³µê²©ì  ì„±ì¥ì£¼ íˆ¬ìì
  BALANCED_INVESTOR     // ê· í˜• ì¡íŒ íˆ¬ìì
  CAUTIOUS_VALUE        // ì‹ ì¤‘í•œ ê°€ì¹˜ íˆ¬ìì
  RISK_TAKER            // ìœ„í—˜ ê°ìˆ˜í˜• íˆ¬ìì
  DEFENSIVE             // ë°©ì–´ì  íˆ¬ìì
}

// Final ì—”ë”© Enum
enum FinalEnding {
  CRASH               // 0~2ê°œ ì •ë‹µ: í™”ì„± ë„ì°© ì‹¤íŒ¨ ğŸ’¥
  MARS                // 3~5ê°œ ì •ë‹µ: í™”ì„± ë„ì°© ğŸ™ï¸
  INVASION            // 6ê°œ ì •ë‹µ: ë„ì§€ ì§„í™” í›„ ì§€êµ¬ ì¹¨ê³µ ğŸ•â†’ğŸ‘¤
}

// í•­í•´ ì„¸ì…˜ (ì‹¤ì‹œê°„ ë°ì´í„° ë™ê¸°í™”ìš©)
model FlightSession {
  id                       Int           @id @default(autoincrement())
  userId                   Int
  user                     User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  rocketId                 Int
  rocket                   Rocket        @relation(fields: [rocketId], references: [id])
  
  // í˜„ì¬ ìƒíƒœ
  currentRound             Int           @default(1)      // í˜„ì¬ ë¼ìš´ë“œ (1~6)
  roundPhase               RoundPhase    @default(NEWS)   // ë¼ìš´ë“œ ì§„í–‰ ë‹¨ê³„
  currentFuel              Float         @default(100.0)  // í˜„ì¬ ì—°ë£Œ
  currentHull              Float         @default(100.0)  // í˜„ì¬ ì„ ì²´ ë‚´êµ¬ë„
  distance                 Float         @default(0.0)    // ì´ë™ ê±°ë¦¬ (í™”ì„±ê¹Œì§€ì˜ ì§„í–‰ë„)
  
  // ì„ íƒí•œ í•­ë¡œ (ì£¼ì‹ ì‹¬ë³¼)
  symbol                   String        @default("AAPL")
  
  // íˆ¬ì ì„±í–¥ ë¶„ì„ìš© ëˆ„ì  ë°ì´í„°
  totalFuelUsed            Float         @default(0.0)    // ì´ ì‚¬ìš© ì—°ë£ŒëŸ‰
  highStabilityThrustCount Int           @default(0)      // ì•ˆì • êµ¬ê°„ ê³ ì¶œë ¥ íšŸìˆ˜
  lowStabilityThrustCount  Int           @default(0)      // ë¶ˆì•ˆì • êµ¬ê°„ ê³ ì¶œë ¥ íšŸìˆ˜ (ìœ„í—˜ ê°ìˆ˜ ì„±í–¥)
  
  // ì„¸ì…˜ ìƒíƒœ
  status                   SessionStatus @default(IN_PROGRESS)
  
  // ì •ë‹µ ìˆ˜ ì¶”ì  (ë‰´ìŠ¤ í•´ì„ ì„±ê³µ íšŸìˆ˜)
  correctAnswers           Int           @default(0)      // ì •ë‹µ ê°œìˆ˜ (0~6)
  
  // ì—”ë”© ê²°ê³¼
  tier                     String?       // S, A, B, C, D, F
  finalEnding              FinalEnding?  // ìµœì¢… ì—”ë”© (ì •ë‹µ ìˆ˜ ê¸°ë°˜)
  investingStyle           InvestingStyle?
  advice                   String?
  
  logs                     FlightLog[]
  createdAt                DateTime      @default(now())
  updatedAt                DateTime      @updatedAt

  @@map("flight_sessions")
}

// íˆ¬ì ì„±í–¥ ë¶„ì„ìš© ë¡œê·¸
model FlightLog {
  id        Int           @id @default(autoincrement())
  sessionId Int
  session   FlightSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  
  // ë¼ìš´ë“œ ì •ë³´
  round     Int           @default(1)   // ì´ ë¡œê·¸ê°€ ê¸°ë¡ëœ ë¼ìš´ë“œ
  
  yValue    Float         // ì¤‘ë ¥íŒŒ ì•ˆì •ë„ (ì£¼ê°€)
  fuelInput Float         // ìœ ì €ì˜ ìŠ¬ë¼ì´ë” ì…ë ¥ê°’ (0~100)
  
  // í•´ë‹¹ ì‹œì ì˜ ìƒíƒœ ìŠ¤ëƒ…ìƒ·
  fuelAfter Float?        // ì´ ì•¡ì…˜ í›„ ë‚¨ì€ ì—°ë£Œ
  hullAfter Float?        // ì´ ì•¡ì…˜ í›„ ë‚¨ì€ ì„ ì²´ ë‚´êµ¬ë„
  distanceAfter Float?    // ì´ ì•¡ì…˜ í›„ ì´ ì´ë™ ê±°ë¦¬
  
  // ì´ë²¤íŠ¸ ê²°ê³¼ ê¸°ë¡
  eventId          Int?             // ì ìš©ëœ ì´ë²¤íŠ¸ ID
  thrustMultiplier Float?           // ì ìš©ëœ ì¶”ë ¥ ë°°ìœ¨
  wasRevealed      Boolean @default(false)  // ë°˜ì „ì´ ê³µê°œë˜ì—ˆëŠ”ì§€
  eventDescription String?          // ì´ë²¤íŠ¸ ê²°ê³¼ ì„¤ëª…
  
  // ì •ë‹µ íŒì •
  isPositiveEvent  Boolean?         // ì´ë²¤íŠ¸ê°€ ì‹¤ì œë¡œ ê¸ì •ì ì´ì—ˆëŠ”ì§€
  userChoseFuel    Boolean?         // ìœ ì €ê°€ ì—°ë£Œ ê³µê¸‰ì„ ì„ íƒí–ˆëŠ”ì§€ (fuelInput >= 50)
  isCorrectChoice  Boolean?         // ì •ë‹µ ì—¬ë¶€ (Pos+ì—°ë£Œ O, Neg+ì—°ë£Œ X)
  
  timestamp DateTime      @default(now())

  @@map("flight_logs")
}

// ì°¨íŠ¸ ë°ì´í„° ìºì‹œ (ì™¸ë¶€ API ë°ì´í„° ìºì‹±ìš©)
model ChartDataCache {
  id        Int      @id @default(autoincrement())
  symbol    String
  data      Json     // ì£¼ê°€ ë°ì´í„° ë°°ì—´
  fetchedAt DateTime @default(now())
  expiresAt DateTime

  @@unique([symbol])
  @@map("chart_data_cache")
}
